# 添加后端指南

当你完成前端学习，准备添加后端时，可以按照这个指南进行。

## 为什么要添加后端？

当你遇到以下需求时，就可以考虑添加后端了：

- ✅ 需要多设备数据同步
- ✅ 需要用户登录/注册功能
- ✅ 需要与其他用户分享数据
- ✅ 需要更复杂的数据分析
- ✅ LocalStorage 容量不够用
- ✅ 想学习后端开发技术

## 推荐的后端技术栈（从简到繁）

### 方案 1: 最简单 - JSON Server (1小时)

**适合**: 快速原型，完全不了解后端的初学者

```bash
# 安装
npm install -g json-server

# 创建数据文件 db.json
{
  "tasks": []
}

# 启动服务器
json-server --watch db.json --port 3001
```

**优点**: 零代码，立即可用
**缺点**: 功能有限，不适合生产环境

### 方案 2: 简单 - Express.js + JSON 文件 (1-2天)

**适合**: 想了解后端基础的学习者

```bash
# 项目结构
JobHunter/
├── frontend/
└── backend/
    ├── server.js         # 主服务器
    ├── data/
    │   └── tasks.json    # 数据存储
    └── package.json
```

**技术栈**:
- Express.js - Node.js 后端框架
- JSON 文件 - 简单数据存储

**学习内容**:
- RESTful API 设计
- HTTP 方法 (GET, POST, PUT, DELETE)
- 路由和中间件

### 方案 3: 中等 - Express.js + SQLite (1周)

**适合**: 想学习数据库基础的学习者

**技术栈**:
- Express.js
- SQLite - 轻量级数据库（单文件）
- TypeScript (可选)

**学习内容**:
- SQL 基础查询
- 数据库设计（表结构、关系）
- ORM 使用（如 Prisma 或 TypeORM）

### 方案 4: 进阶 - NestJS + PostgreSQL (2-4周)

**适合**: 想全面学习后端开发的学习者

**技术栈**:
- NestJS - 企业级后端框架
- PostgreSQL - 专业数据库
- TypeORM - 对象关系映射
- JWT - 身份认证

**学习内容**:
- 后端架构设计
- 依赖注入
- 身份认证和授权
- 数据库迁移

## 快速开始：方案 2 示例

### 第一步：创建后端项目

```bash
# 在项目根目录
mkdir backend
cd backend
npm init -y
npm install express cors
```

### 第二步：创建服务器文件

创建 `backend/server.js`:

```javascript
const express = require('express');
const cors = require('cors');
const fs = require('fs');
const path = require('path');

const app = express();
const PORT = 3001;
const DATA_FILE = path.join(__dirname, 'data', 'tasks.json');

// 中间件
app.use(cors());
app.use(express.json());

// 读取数据
function readTasks() {
  if (!fs.existsSync(DATA_FILE)) {
    return [];
  }
  const data = fs.readFileSync(DATA_FILE, 'utf8');
  return JSON.parse(data);
}

// 写入数据
function writeTasks(tasks) {
  const dir = path.dirname(DATA_FILE);
  if (!fs.existsSync(dir)) {
    fs.mkdirSync(dir, { recursive: true });
  }
  fs.writeFileSync(DATA_FILE, JSON.stringify(tasks, null, 2));
}

// API 路由
app.get('/api/tasks', (req, res) => {
  const tasks = readTasks();
  res.json(tasks);
});

app.post('/api/tasks', (req, res) => {
  const tasks = readTasks();
  const newTask = {
    id: Date.now().toString(),
    ...req.body,
    createdAt: new Date(),
    updatedAt: new Date(),
  };
  tasks.push(newTask);
  writeTasks(tasks);
  res.status(201).json(newTask);
});

app.put('/api/tasks/:id', (req, res) => {
  const tasks = readTasks();
  const index = tasks.findIndex(t => t.id === req.params.id);

  if (index === -1) {
    return res.status(404).json({ error: 'Task not found' });
  }

  tasks[index] = {
    ...tasks[index],
    ...req.body,
    updatedAt: new Date(),
  };

  writeTasks(tasks);
  res.json(tasks[index]);
});

app.delete('/api/tasks/:id', (req, res) => {
  const tasks = readTasks();
  const filtered = tasks.filter(t => t.id !== req.params.id);
  writeTasks(filtered);
  res.status(204).send();
});

app.listen(PORT, () => {
  console.log(`后端服务器运行在 http://localhost:${PORT}`);
});
```

### 第三步：修改前端代码

创建 `frontend/src/api/taskApi.ts`:

```typescript
import { Task, CreateTaskInput } from '../types/task';

const API_URL = 'http://localhost:3001/api';

export const taskApi = {
  // 获取所有任务
  async getAllTasks(): Promise<Task[]> {
    const response = await fetch(`${API_URL}/tasks`);
    return response.json();
  },

  // 创建任务
  async createTask(input: CreateTaskInput): Promise<Task> {
    const response = await fetch(`${API_URL}/tasks`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(input),
    });
    return response.json();
  },

  // 更新任务
  async updateTask(id: string, updates: Partial<Task>): Promise<Task> {
    const response = await fetch(`${API_URL}/tasks/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updates),
    });
    return response.json();
  },

  // 删除任务
  async deleteTask(id: string): Promise<void> {
    await fetch(`${API_URL}/tasks/${id}`, {
      method: 'DELETE',
    });
  },
};
```

修改 `frontend/src/App.tsx`:

```typescript
import { useState, useEffect } from 'react';
import { taskApi } from './api/taskApi';
// ... 其他导入

function App() {
  const [tasks, setTasks] = useState<Task[]>([]);
  const [loading, setLoading] = useState(true);

  // 从后端加载任务
  useEffect(() => {
    taskApi.getAllTasks()
      .then(setTasks)
      .finally(() => setLoading(false));
  }, []);

  const handleCreateTask = async (input: CreateTaskInput) => {
    const newTask = await taskApi.createTask(input);
    setTasks([...tasks, newTask]);
  };

  // ... 其他处理函数也改为异步调用 API
}
```

### 第四步：启动项目

```bash
# 终端 1: 启动后端
cd backend
node server.js

# 终端 2: 启动前端
cd frontend
npm run dev
```

## 迁移数据

### 从 LocalStorage 迁移到后端

1. 在浏览器控制台导出数据：
   ```javascript
   const tasks = localStorage.getItem('jobhunter-tasks');
   console.log(tasks);
   // 复制输出的 JSON
   ```

2. 保存到 `backend/data/tasks.json`

3. 刷新前端页面，数据就会从后端加载

## 下一步学习

完成基础后端后，可以继续学习：

1. **添加用户认证**
   - 注册/登录功能
   - JWT Token
   - 密码加密

2. **升级数据库**
   - 从 JSON 文件迁移到 SQLite
   - 学习 SQL 查询
   - 使用 ORM

3. **部署到云服务**
   - Heroku (免费)
   - Vercel (前端)
   - Railway (后端)

4. **添加更多功能**
   - 实时通知
   - 数据分析
   - 导出报表

## 学习资源

- **Express.js 官方文档**: https://expressjs.com/
- **NestJS 官方文档**: https://nestjs.com/
- **SQLite 教程**: https://www.sqlitetutorial.net/
- **RESTful API 设计**: https://restfulapi.net/

## 获取帮助

如果遇到问题：
1. 查看浏览器控制台错误
2. 查看后端终端日志
3. 使用 Postman 测试 API
4. 在 GitHub Issues 提问

---

祝学习顺利！记住：先把前端学扎实，再慢慢添加后端功能。
